SubDir TOP eressea ;

TargetDirectory ;
SubDirHdrs $(SUBDIR)/../common/gamecode ;
SubDirHdrs $(SUBDIR)/../common/kernel ;
SubDirHdrs $(SUBDIR)/../common/util ;
SubDirHdrs $(SUBDIR)/../common ;
SubDirHdrs $(SUBDIR)/.. ;

UsingLua ;
UsingLuabind ;

SEARCH_SOURCE += [ FDirName $(TOP) common iniparser ] ;
SEARCH_SOURCE += [ FDirName $(SUBDIR) curses ] ;
SEARCH_SOURCE += [ FDirName $(SUBDIR) lua ] ;
SubDirC++Flags -DHAVE_LUA ;

SubDirHdrs $(XMLHDRS) ;

LUASERVER = eressea-lua ;
SERVER = eressea ;
GMTOOL = gmtool ;

SERVER_SOURCES = main.c korrektur.c ;

SHARED_BINDINGS =
 <lua>alliance.cpp
 <lua>building.cpp
 <lua>eressea.cpp
 <lua>event.cpp
 <lua>faction.cpp
 <lua>message.cpp
 <lua>objects.cpp
 <lua>region.cpp
 <lua>ship.cpp
 <lua>spell.cpp
 <lua>unit.cpp
 <lua>item.cpp
;

Library luabindings : $(SHARED_BINDINGS) ;

LUASERVER_SOURCES =
 <common!iniparser>iniparser.c
 <lua>script.cpp
 <lua>gamecode.cpp
 server.cpp
 korrektur.c
 console.c
 ;

GMTOOL_SOURCES =
 <common!iniparser>iniparser.c
 <lua>gm.cpp
 <curses>listbox.c
 console.c
 editing.c
 gmmain.cpp
 gmtool.c
 ;

# old eressea server. use only for testing.
LinkLibraries $(SERVER) :
 gamecode items spells kernel modules attributes races triggers util ;
libxml2 $(SERVER) ;
LINKLIBS on $(SERVER) += -lm ;
# build disabled:
# Main $(SERVER) : $(SERVER_SOURCES) ;

# eressea-server with lua scripting
LinkLibraries $(LUASERVER) :
 luabindings gamecode items spells kernel modules attributes races triggers util ;
luabind $(LUASERVER) ;
libxml2 $(LUASERVER) ;
LINKLIBS on $(LUASERVER) += -lm -ldl -lstdc++ ;
if $(DEBUG) = 1 {
   LINKLIBS on $(LUASERVER) += -lmcheck ;
}
Main $(LUASERVER) : $(LUASERVER_SOURCES) ;

# the curses-based GM tool (now with luabind)
LinkLibraries $(GMTOOL) :
 luabindings items spells kernel modules attributes races triggers util ;
luabind $(GMTOOL) ;
libxml2 $(GMTOOL) ;
LINKLIBS on $(GMTOOL) += -lm -lncurses -ldl -lstdc++ ;
Main $(GMTOOL) : $(GMTOOL_SOURCES) ;
