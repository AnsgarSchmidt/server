SubDir TOP eressea ;

TargetDirectory ;
SubDirHdrs $(SUBDIR)/../common/gamecode ;
SubDirHdrs $(SUBDIR)/../common/kernel ;
SubDirHdrs $(SUBDIR)/../common/util ;
SubDirHdrs $(SUBDIR)/../common ;
SubDirHdrs $(SUBDIR)/.. ;

SubDirHdrs $(XMLHDRS) ;

LUASERVER = eressea-lua ;
SERVER = eressea ;

SERVER_SOURCES = main.c korrektur.c ;
LUASERVER_SOURCES =
 <lua>alliance.cpp
 <lua>building.cpp
 <lua>eressea.cpp
 <lua>event.cpp
 <lua>faction.cpp
 <lua>region.cpp
 <lua>script.cpp
 <lua>ship.cpp
 <lua>spell.cpp
 <lua>unit.cpp
 <lua>item.cpp
 server.cpp
 korrektur.c
 console.c
 ;

LinkLibraries $(SERVER) :
 gamecode kernel items modules attributes spells races triggers util ;
LinkLibraries $(LUASERVER) :
 gamecode kernel items modules attributes spells races triggers util ;

iconv $(SERVER) ;
libxml2 $(SERVER) ;
LINKLIBS on $(SERVER) += -L$(LUABIND_ROOT)/lib -lm ;

luabind $(LUASERVER) ;
iconv $(LUASERVER) ;
libxml2 $(LUASERVER) ;
LINKLIBS on $(LUASERVER) += -lm -ldl -lstdc++ ;

if ! $(WITHOUT_LUA) {
 SEARCH_SOURCE += [ FDirName $(SUBDIR) lua ] ;
 SubDirC++Flags -DHAVE_LUA ;
 UsingLua ;
 UsingLuabind ;

 Main $(LUASERVER) : $(LUASERVER_SOURCES) ;
}

Main $(SERVER) : $(SERVER_SOURCES) ;
